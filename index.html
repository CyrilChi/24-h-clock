<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>24小时一圈的表</title>
    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script src="../calcnew.js"></script>
  </head>
  <body>
    <div class="clocks">
      <p class="clocks-date-text" id="dataText">当前日期</p>
      <canvas id="canvas" width="500" height="500"></canvas>
    </div>
  </body>

  <script>
    var canvas, ctx;
    var clockRadius = 250; // 中心点、半径
    var clockImage;

    // draw functions :
    function clear() {
      // clear canvas function
      ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
    }

    function drawScene() {
      // main drawScene function
      clear(); // clear canvas

      // draw 扇形
      ctx.moveTo(clockRadius, clockRadius);
      ctx.arc(clockRadius, clockRadius, 150, (Math.PI * 3) / 12, (Math.PI * 12) / 12, false);
      ctx.closePath();
      ctx.fillStyle = 'rgba(0,0,0,0.1)';
      ctx.fill();
      // draw 日出日落
      let sunrise = calcnew(1, 39.9, 116.4, 2022, 9, 9);
      let sunset = calcnew(2, 39.9, 116.4, 2022, 9, 9);
      let sunriseHoures = sunrise.getHours();
      let sunriseMinutes = sunrise.getMinutes();
      let sunsetHoures = sunset.getHours();
      let sunsetMinutes = sunset.getMinutes();

      // get current time
      var date = new Date();
      let year = date.getFullYear();
      let month = date.getMonth() + 1;
      let day = date.getDate();
      let week = date.getDay();
      var hours = date.getHours();
      var minutes = date.getMinutes();
      var seconds = date.getSeconds();
      var hour = hours + minutes / 60;
      var minute = minutes + seconds / 60;
      $('#dataText').text(`${year}年${month}月${day}日 周${week}`);
      // save current context
      ctx.save();
      // draw clock image (as background)
      ctx.translate(canvas.width / 2, canvas.height / 2);
      ctx.beginPath();
      // draw numbers
      ctx.fillStyle = '#000';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      for (var n = 1; n <= 24; n++) {
        ctx.font = '20px Arial';
        var theta = ((n - 6) * (Math.PI * 2)) / 24;
        var x = clockRadius * 0.75 * Math.cos(theta);
        var y = clockRadius * 0.75 * Math.sin(theta);
        ctx.fillText(n, x, y);
      }
      for (var n = 1; n <= 60; n++) {
        ctx.font = '36px Arial';
        if (n % 5 == 0) {
          var theta = ((n - 15) * (Math.PI * 2)) / 60;
          var x = clockRadius * 0.9 * Math.cos(theta);
          var y = clockRadius * 0.9 * Math.sin(theta);
          ctx.fillText(n, x, y);
        }
      }
      // draw seconds
      ctx.save();
      var theta = ((seconds - 15) * 2 * Math.PI) / 60;
      ctx.rotate(theta);
      ctx.beginPath();
      ctx.moveTo(-15, -5);
      ctx.lineTo(-15, 5);
      ctx.lineTo(clockRadius * 0.8, 1);
      ctx.lineTo(clockRadius * 0.8, -1);
      ctx.fillStyle = '#0f0';
      ctx.fill();
      ctx.restore();
      // draw minutes
      ctx.save();
      var theta = ((minute - 15) * 2 * Math.PI) / 60;
      ctx.rotate(theta);
      ctx.beginPath();
      ctx.moveTo(-15, -5);
      ctx.lineTo(-15, 5);
      ctx.lineTo(clockRadius * 0.8, 1);
      ctx.lineTo(clockRadius * 0.8, -1);
      ctx.fill();
      ctx.restore();
      // draw hour
      ctx.save();
      var theta = ((hour - 6) * 2 * Math.PI) / 24;
      ctx.rotate(theta);
      ctx.beginPath();
      ctx.moveTo(-15, -5);
      ctx.lineTo(-15, 5);
      ctx.lineTo(clockRadius * 0.6, 1);
      ctx.lineTo(clockRadius * 0.6, -1);
      ctx.fill();
      ctx.restore();

      ctx.restore();
    }

    // initialization
    $(function () {
      canvas = document.getElementById('canvas');
      ctx = canvas.getContext('2d');
      clockImage = new Image();
      clockImage.src = 'https://static.runoob.com/images/mix/125855_nnla_89964.png';
      setInterval(drawScene, 1000); // loop drawScene
    });
  </script>
  <style>
    * {
      width: 100%;
    }
    .clocks {
      width: 900px;
      height: 900px;
      margin: 25px auto;
      position: relative;
      text-align: center;
    }
    .clocks-date-text {
      font-size: 60px;
    }
  </style>
</html>
